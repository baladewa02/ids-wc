<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IDS List View Sample</title>
    <script
      type="module"
      src="/node_modules/ids-enterprise-wc/enterprise-wc.all.iife.js"
    ></script>
    <link
      rel="stylesheet"
      href="/node_modules/ids-enterprise-wc/themes/ids-theme-default-light.css"
    />
  </head>
  <body>
    <ids-container role="main" padding="8" hidden>
      <ids-theme-switcher mode="light"></ids-theme-switcher>

      <ids-layout-grid cols="1" gap="md" padding="md">
        <ids-layout-grid-cell>
        
          <ids-list-view id="custom_list"
          pagination="standalone"
          page-size="10"
          selectable="mixed"
          suppress-deactivation="true"
        >
          <template>
            <ids-text font-size="16" type="h2">${productName}</ids-text>
            <ids-text font-size="12" type="span">Count: ${units}</ids-text>
            <ids-text font-size="12" type="span">Price: $ ${unitPrice}</ids-text>
            <ids-button class="action-btn" id="select">Select</ids-button>
            <ids-button class="action-btn" id="close">Close</ids-button>
          </template>
        </ids-list-view>
        </ids-layout-grid-cell>
      </ids-layout-grid>
    </ids-container>

    <script type="module">
      document.addEventListener('DOMContentLoaded', () => {
        const listData = [{
            "id":1,
            "productId":"7439937961",
            "productName":"Steampan Lid",
            "inStock":true,
            "units":"9",
            "unitPrice":"23",
            "color":"Green",
            "disabled": true,
            "escalated": "2"
          },
          {
            "id":2,
            "productId":"3672150959",
            "productName":"Coconut - Creamed, Pure",
            "inStock":true,
            "units":"588",
            "unitPrice":"18",
            "color":"Yellow",
            "disabled": true,
            "escalated": "1"
          },
          {
            "id":3,
            "productId":"8233719404",
            "productName":"Onions - Red",
            "inStock":false,
            "units":"68",
            "unitPrice":"58",
            "color":"Green"
          },
          {
            "id":4,
            "productId":"2451410442",
            "productName":"Pasta - Fusili Tri - Coloured",
            "inStock":true,
            "units":"02",
            "unitPrice":"24",
            "color":"Crimson"
          },
          {
            "id":5,
            "productId":"4264251249",
            "productName":"Bread - Crumbs, Bulk",
            "inStock":true,
            "units":"5",
            "unitPrice":"59",
            "color":"Maroon"
          }];

          let allowActivation = false;
          const listView = document.querySelector('#custom_list');
          listView.data = listData;

          listView.addEventListener('beforeactivated', (e) => {
            console.info('beforeactivated', e.detail);
            if (!allowActivation) {
              e.detail.response(false);
            }
            allowActivation = false;
          });

          listView.addEventListener('beforedeactivated', (e) => {
            console.info('beforedeactivated', e.detail);
            e.detail.response(false);
          });

        listView.container?.addEventListener('click', (e) => {
          if (e.target.classList.contains('action-btn')) {
            const item = e.target.closest('ids-list-view-item');
            if (item) {
              const pageIndex = listView.items.indexOf(item);
              const dataIndex = listView.dataIndex(pageIndex);
              if (dataIndex !== null) {
                if (e.target.id === 'close') {
                  listView.suppressDeactivation = false;
                  listView.deactivateItem(dataIndex);
                  listView.suppressDeactivation = true;
                } else {
                  allowActivation = true;
                  listView.activateItem(dataIndex);
                }
              }
            }
          }
        });
      });
    </script>
  </body>
</html>
